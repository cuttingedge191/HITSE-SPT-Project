<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <title>通用批发零售业务管理系统</title>
    <meta name="description" content="Admin, Dashboard, Bootstrap, Bootstrap 4, Angular, AngularJS"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- for ios 7 style, multi-resolution icon of 152x152 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-barstyle" content="black-translucent">
    <link rel="apple-touch-icon" th:href="@{/assets/images/logo.png}">
    <meta name="apple-mobile-web-app-title" content="Flatkit">
    <!-- for Chrome on Android, multi-resolution icon of 196x196 -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" sizes="196x196" th:href="@{/assets/images/logo.png}">

    <!-- style -->
    <link rel="stylesheet" th:href="@{/assets/animate.css/animate.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/glyphicons/glyphicons.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/font-awesome/css/font-awesome.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/material-design-icons/material-design-icons.css}" type="text/css"/>

    <link rel="stylesheet" th:href="@{/assets/bootstrap/dist/css/bootstrap.min.css}" type="text/css"/>
    <!-- build:css @{/assets/styles/app.min.css} -->
    <link rel="stylesheet" th:href="@{/assets/styles/app.css}" type="text/css"/>
    <!-- endbuild -->
    <link rel="stylesheet" th:href="@{/assets/styles/font.css}" type="text/css"/>
</head>

<body>
<div class="app" id="app">

    <!-- ############ LAYOUT START-->

    <!-- aside -->
    <div id="aside" class="app-aside modal nav-dropdown">
        <!-- fluid app aside -->
        <div class="left navside dark dk" data-layout="column">
            <div class="navbar no-radius">
                <!-- brand -->
                <a class="navbar-brand">
                    <!-- 原来的图标
                <div ui-include="'@{/assets/images/logo.svg'"></div>
                <img th:src="@{/assets/images/logo.png}" alt="." class="hide">
            -->
                    <span class="hidden-folded inline">通用批发零售</span><br>
                    <span class="hidden-folded inline">业务管理系统</span>
                </a>
                <!-- /brand -->
            </div>
            <div class="hide-scroll" data-flex>
                <nav class="scroll nav-light">

                    <ul class="nav" ui-nav>
                        <li class="nav-header hidden-folded">
                            <small class="text-muted">主要功能</small>
                        </li>

                        <li>
                            <a th:href="@{/index}">
                                    <span class="nav-icon">
                                        <i class="material-icons">&#xe3fc;
                                            <span ui-include="'@{/assets/images/i_0.svg'"></span>
                                        </i>
                                    </span>
                                <span class="nav-text">概览界面</span>
                            </a>
                        </li>

                        <li th:if="${#strings.substring(session.permissions, 1, 2)=='1'}">
                            <a th:href="@{/goodsView}">
                                    <span class="nav-icon">
                                        <i class="material-icons">&#xe5c3;
                                            <span ui-include="'@{/assets/images/i_1.svg'"></span>
                                        </i>
                                    </span>
                                <span class="nav-text">货品管理</span>
                            </a>
                        </li>

                        <li th:if="${#strings.substring(session.permissions, 2, 5)!='000'}">
                            <a>
                                    <span class="nav-caret">
                                        <i class="fa fa-caret-down"></i>
                                    </span>
                                <span class="nav-icon">
                                        <i class="material-icons">&#xe8f0;
                                            <span ui-include="'@{/assets/images/i_2.svg'"></span>
                                        </i>
                                    </span>
                                <span class="nav-text">库存管理</span>
                            </a>
                            <ul class="nav-sub">
                                <li>
                                    <a th:href="@{/inventoryView}">
                                        <span class="nav-text">库存查询</span>
                                    </a>
                                </li>
                                <li th:if="${#strings.substring(session.permissions, 3, 4)=='1'}">
                                    <a th:href="@{/inventoryCheck}">
                                        <span class="nav-text">库存盘点</span>
                                    </a>
                                </li>
                                <li th:if="${#strings.substring(session.permissions, 4, 5)=='1'}">
                                    <a th:href="@{/inventoryTrans}">
                                        <span class="nav-text">库存调度</span>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li th:if="${#strings.substring(session.permissions, 5, 9)!='0000'}">
                            <a>
                                    <span class="nav-caret">
                                        <i class="fa fa-caret-down"></i>
                                    </span>
                                <span class="nav-icon">
                                        <i class="material-icons">&#xe8d2;
                                            <span ui-include="'@{/assets/images/i_3.svg'"></span>
                                        </i>
                                    </span>
                                <span class="nav-text">销售管理</span>
                            </a>
                            <ul class="nav-sub">
                                <li>
                                    <a th:href="@{/ordersView}">
                                        <span class="nav-text">销售单查询</span>
                                    </a>
                                </li>
                                <li th:if="${#strings.substring(session.permissions, 5, 6)=='1'}">
                                    <a th:href="@{/addOrder}">
                                        <span class="nav-text">新增批发销售单</span>
                                    </a>
                                </li>
                                <li th:if="${#strings.substring(session.permissions, 6, 7)=='1'}">
                                    <a th:href="@{/pos}">
                                        <span class="nav-text">零售POS收银台</span>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li th:if="${#strings.substring(session.permissions, 9, 10)=='1'}">
                            <a th:href="@{/clientInfoSearch}">
                                    <span class="nav-icon">
                                        <i class="material-icons">&#xe429;
                                            <span ui-include="'@{/assets/images/i_4.svg'"></span>
                                        </i>
                                    </span>
                                <span class="nav-text">客户管理</span>
                            </a>
                        </li>

                        <li th:if="${#strings.substring(session.permissions, 10, 11)=='1'}">
                            <a th:href="@{/userInfoSearch}">
                                    <span class="nav-icon">
                                        <i class="material-icons">&#xe3e8;
                                            <span ui-include="'@{/assets/images/i_5.svg'"></span>
                                        </i>
                                    </span>
                                <span class="nav-text">系统用户管理</span>
                            </a>
                        </li>

                        <li class="nav-header hidden-folded">
                            <small class="text-muted">个人账号服务</small>
                        </li>

                        <li>
                            <a th:href="@{/account}">
                                    <span class="nav-icon">
                                        <i class="material-icons">&#xe1b8;
                                            <span ui-include="'@{/assets/images/i_8.svg'"></span>
                                        </i>
                                    </span>
                                <span class="nav-text">账号信息修改</span>
                            </a>
                        </li>

                        <li>
                            <a data-toggle="modal" data-target="#m-a-a" ui-toggle-class="bounce" ui-target="#animate">
                                    <span class="nav-icon">
                                        <i class="material-icons"></i>
                                    </span>
                                <span class="nav-text">退出登录</span>
                            </a>
                        </li>

                        <li class="nav-header hidden-folded">
                            <small class="text-muted">关于</small>
                        </li>

                        <li class="hidden-folded">
                            <a th:href="@{/about}">
                                    <span class="nav-icon">
                                        <i class="material-icons">&#xe39e;
                                            <span ui-include="'@{/assets/images/i_6.svg'"></span>
                                        </i>
                                    </span>
                                <span class="nav-text">开发者信息</span>
                            </a>
                        </li>

                    </ul>
                </nav>
            </div>
            <!-- 用户登录状态显示 -->
            <div class="b-t">
                <div class="nav-fold">
                        <span class="pull-left">
                            <img th:src="@{/assets/images/a0.jpg}" alt="..." class="w-40 img-circle">
                        </span>
                    <span class="clear hidden-folded p-x">
                            <span class="block _500" th:text="${session.name}">【用户姓名】</span>
                            <small class="block text-muted" th:text="${session.position}">【用户身份】</small>
                            <small class="block text-muted"><i class="fa fa-circle text-success m-r-sm"></i>在线</small>
                        </span>
                </div>
            </div>
        </div>
    </div>
    <!-- / -->

    <!-- content -->
    <div id="content" class="app-content box-shadow-z0" role="main">

        <div ui-view class="app-body" id="view">

            <!-- ############ PAGE START-->
            <div class="p-a white lt box-shadow">
                <div class="row">
                    <div class="col-sm-6">
                        <h4 class="mb-0 _300" th:text="${session.name}+'，欢迎您使用本系统！'"></h4>
                    </div>
                </div>
            </div>

            <div class="padding">

                <div class="row">
                    <div class="col-sm-6">
                        <div class="box">
                            <div class="box-header">
                                <div class="row">
                                    <div class="col-md-7">
                                        <h5>库存概览</h5>
                                        <small class="block text-muted">可视化展示选定仓库中的积压资金额</small>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group row">
                                            <label class="col-sm-4 form-control-label" for="select_il">仓库：</label>
                                            <select class="col-sm-8 form-control" ui-jp="select2" id="select_il"
                                                    ui-options="{theme: 'bootstrap'}" name="select_il"
                                                    onchange="selectIl_onchange()">
                                                <option th:each="inventory_list:${inventory_lists}"
                                                        th:class="'select inventory_' + ${inventory_list.il_id}"
                                                        th:value="${inventory_list.il_id}"
                                                        th:text="${inventory_list.inventory_name}"></option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm-1">
                                        <ul class="nav">
                                            <li class="nav-item inline">
                                                <a class="nav-link" href="javascript:selectIl_onchange()">
                                                    <i class="material-icons md-18">&#xe863;</i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="box-body">
                                <div id="inventory_pie" style="height:300px">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-6">
                        <div class="box">
                            <div class="box-header">
                                <div class="row">
                                    <div class="col-md-4">
                                        <h5>销售概览</h5>
                                        <small class="block text-muted">可视化展示部分货品销售额统计</small>
                                        <input type="hidden" id="time_opt2" value="week">
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group row">
                                            <label for="select_g"
                                                   class="col-md-3 form-control-label">货品：</label>
                                            <select class="form-control col-md-9" ui-jp="select2" id="select_g"
                                                    ui-options="{theme: 'bootstrap'}" name="select_g"
                                                    onchange="selectS_onchange(document.getElementById('time_opt2').value)">
                                                <optgroup label="货品名称-条码">
                                                    <div th:each="goodsInfo:${goodsInfos}">
                                                        <option th:value="${goodsInfo.g_id}"
                                                                th:text="${goodsInfo.name}+'-'+${goodsInfo.g_id}"></option>
                                                    </div>
                                                </optgroup>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="box-tool">
                                        <ul class="nav">
                                            <li class="nav-item inline">
                                                <a class="nav-link"
                                                   href="javascript:selectS_onchange(document.getElementById('time_opt2').value)">
                                                    <i class="material-icons md-18">&#xe863;</i>
                                                </a>
                                            </li>
                                            <li class="nav-item inline dropdown">
                                                <a class="nav-link" data-toggle="dropdown">
                                                    <i class="material-icons md-18">&#xe5d4;</i>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-scale pull-right">
                                                    <a class="dropdown-item"
                                                       href="javascript:selectS_onchange('week')">近7天</a>
                                                    <a class="dropdown-item"
                                                       href="javascript:selectS_onchange('month')">近30天</a>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="box-body">
                                <div id="sales_bar" style="height:300px">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12">
                        <div class="box">
                            <div class="box-header">
                                <h3>经营状况概览</h3>
                                <small class="block text-muted">可视化展示经营状况数据</small>
                                <input type="hidden" id="time_opt1" value="7">
                            </div>
                            <div class="box-body">
                                <div id="operating_line" style="height:300px">
                                </div>
                            </div>
                            <div class="box-tool">
                                <ul class="nav">
                                    <li class="nav-item inline">
                                        <a class="nav-link"
                                           href="javascript:selectOp_onchange(document.getElementById('time_opt1').value)">
                                            <i class="material-icons md-18">&#xe863;</i>
                                        </a>
                                    </li>
                                    <li class="nav-item inline dropdown">
                                        <a class="nav-link" data-toggle="dropdown">
                                            <i class="material-icons md-18">&#xe5d4;</i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-scale pull-right">
                                            <a class="dropdown-item"
                                               href="javascript:selectOp_onchange('7')">近1周</a>
                                            <a class="dropdown-item"
                                               href="javascript:selectOp_onchange('28')">近4周</a>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- .modal -->
    <div id="m-a-a" class="modal fade animate" data-backdrop="true">
        <div class="modal-dialog" id="animate">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">退出登录</h5>
                </div>
                <div class="modal-body text-center p-lg">
                    <p>您是否确定退出登录？</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn dark-white p-x-md" data-dismiss="modal">取消</button>
                    <a class="btn danger p-x-md" th:href="@{/logout}">确认</a>
                </div>
            </div><!-- /.modal-content -->
        </div>
    </div>
    <!-- / .modal -->
</div>
<!-- ############ PAGE END-->

<!-- ############ LAYOUT END-->

<!-- build:js scripts/app.html.js} -->
<!-- jQuery -->
<script th:src="@{/libs/jquery/jquery/dist/jquery.js}"></script>
<!-- Bootstrap -->
<script th:src="@{/libs/jquery/tether/dist/js/tether.min.js}"></script>
<script th:src="@{/libs/jquery/bootstrap/dist/js/bootstrap.js}"></script>

<!-- 用于概览图显示 -->
<script th:src="@{/libs/js/echarts/build/dist/echarts-all.js}"></script>

<script>
    // 页面加载时自动运行的函数
    function autoRun() {
        selectOp_onchange(document.getElementById('time_opt1').value);
        selectIl_onchange();
        selectS_onchange(document.getElementById('time_opt2').value);
    }

    // 从后台获取经营状况概览可视化数据
    function selectOp_onchange(type) {
        if (type === "week") {
            document.getElementById("time_opt1").setAttribute("value", "week");
            $.ajax({
                url: "/getOperationOverView?type=week",
                dataType: "json",
                type: 'GET',
                success: function (dataInfo) {
                    loadOperatingLine();
                }
            })
        } else {
            document.getElementById("time_opt1").setAttribute("value", "month");
            $.ajax({
                url: "/getOperationOverView?type=month",
                dataType: "json",
                type: 'GET',
                success: function (dataInfo) {
                    loadOperatingLine();
                }
            })
        }
    }

    // 从后台获取库存概览可视化数据
    function selectIl_onchange() {
        $.ajax({
            url: "/getInventoryOverView?il_id=" + $('#select_il').val(),
            dataType: "json",
            type: 'GET',
            success: function (dataInfo) {
                loadInventoryPie(dataInfo[0], dataInfo[1]);
            }
        })
    }

    // 从后台获取销售概览可视化数据
    function selectS_onchange(type) {
        if (type === "week") {
            document.getElementById("time_opt2").setAttribute("value", "week");
            $.ajax({
                url: "/getSalesOverView?g_id=" + $('#select_g').val() + "&type=week",
                dataType: "json",
                type: 'GET',
                success: function (dataInfo) {
                    loadSalesBar(dataInfo[0], dataInfo[1]);
                }
            })
        } else {
            document.getElementById("time_opt2").setAttribute("value", "month");
            $.ajax({
                url: "/getSalesOverView?g_id=" + $('#select_g').val() + "&type=month",
                dataType: "json",
                type: 'GET',
                success: function (dataInfo) {
                    loadSalesBar(dataInfo[0], dataInfo[1]);
                }
            })
        }
    }

    // 重新载入经营状况概览折线图
    function loadOperatingLine() {
        var operatingLine = echarts.init(document.getElementById('operating_line'));
        var option = {
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['销售金额', '盈利金额', '进货金额', '库存积压金额']
            },
            xAxis: [
                {
                    type: 'category',
                    boundaryGap: false,
                    data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                }
            ],
            yAxis: [
                {
                    type: 'value'
                }
            ],
            grid: {
                x2: 10
            },
            series: [
                {
                    name: '销售金额',
                    type: 'line',
                    stack: 'total',
                    data: [120, 132, 101, 134, 90, 230, 210]
                },
                {
                    name: '盈利金额',
                    type: 'line',
                    stack: 'total',
                    data: [220, 182, 191, 234, 290, 330, 310]
                },
                {
                    name: '进货金额',
                    type: 'line',
                    stack: 'total',
                    data: [150, 232, 201, 154, 190, 330, 410]
                },
                {
                    name: '库存积压金额',
                    type: 'line',
                    stack: 'total',
                    data: [320, 332, 301, 334, 390, 330, 320]
                },
            ]
        }
        operatingLine.setOption(option);
    }

    // 重新载入库存概览可视化饼状图
    function loadInventoryPie(legend_data, series_data) {
        var l_data = JSON.parse(legend_data);
        var s_data = JSON.parse(series_data);
        var inventoryPie = echarts.init(document.getElementById('inventory_pie'));
        var option = {
            tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b} : {c} ({d}%)'
            },
            legend: {
                orient: 'vertical',
                x: 'right',
                data: l_data
            },
            calculable: true,
            series: [
                {
                    name: '积压资金额（元）',
                    type: 'pie',
                    radius: '55%',
                    center: ['50%', '60%'],
                    data: s_data
                }
            ]
        };
        inventoryPie.setOption(option);
    }

    // 重新载入销售概览可视化柱状图
    function loadSalesBar(xAxis_data, series_data) {
        var x_data = JSON.parse(xAxis_data);
        var s_data = JSON.parse(series_data);
        var salesBar = echarts.init(document.getElementById('sales_bar'));
        var time_opt = document.getElementById("time_opt2").value;
        if (time_opt === "week")
            time_opt = "最近7天 ";
        else
            time_opt = "最近30天 ";
        var option = {
            tooltip: {
                trigger: 'item'
            },
            calculable: true,
            grid: {
                borderWidth: 0
            },
            xAxis: [
                {
                    type: 'category',
                    show: false,
                    data: x_data
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    show: true
                }
            ],
            series: [
                {
                    name: time_opt + '销售额（元）',
                    type: 'bar',
                    itemStyle: {
                        normal: {
                            color: function (params) {
                                var colorList = [
                                    '#C1232B', '#B5C334', '#FCCE10', '#E87C25', '#27727B',
                                    '#FE8463', '#9BCA63', '#FAD860', '#F3A43B', '#60C0DD',
                                    '#D7504B', '#C6E579', '#F4E001', '#F0805A', '#26C0C0'
                                ];
                                return colorList[params.dataIndex]
                            },
                            label: {
                                show: true,
                                position: 'top',
                                formatter: '{b}\n{c}'
                            }
                        }
                    },
                    data: s_data
                }
            ]
        }
        salesBar.setOption(option);
    }

    window.onload = autoRun();
</script>
<!-- /用于概览图显示 -->

<!-- core -->
<script th:src="@{/libs/jquery/underscore/underscore-min.js}"></script>
<script th:src="@{/libs/jquery/jQuery-Storage-API/jquery.storageapi.min.js}"></script>
<script th:src="@{/libs/jquery/PACE/pace.min.js}"></script>

<script th:src="@{/scripts/config.lazyload.js}"></script>

<script th:src="@{/scripts/palette.js}"></script>
<script th:src="@{/scripts/ui-load.js}"></script>
<script th:src="@{/scripts/ui-jp.js}"></script>
<script th:src="@{/scripts/ui-include.js}"></script>
<script th:src="@{/scripts/ui-device.js}"></script>
<script th:src="@{/scripts/ui-form.js}"></script>
<script th:src="@{/scripts/ui-nav.js}"></script>
<script th:src="@{/scripts/ui-screenfull.js}"></script>
<script th:src="@{/scripts/ui-scroll-to.js}"></script>
<script th:src="@{/scripts/ui-toggle-class.js}"></script>

<script th:src="@{/scripts/app.js}"></script>

<!-- ajax -->
<script th:src="@{/libs/jquery/jquery-pjax/jquery.pjax.js}"></script>
<script th:src="@{/scripts/ajax.js}"></script>
<!-- endbuild -->

</body>

</html>
